<h1>Create New Account</h1>

<div class="row w-100">
    <div class="col-6">
        <%= render 'form', user: @user %>
    </div>
    <div class="col-6">
        <div id="map" style="min-width: 100%; width: 100%; min-height: 100%; height: 100%;"></div>
    </div>
</div>

<script>
$(document).ready(function() {
    mapboxgl.accessToken = 'pk.eyJ1IjoibGltankwMTE0IiwiYSI6ImNqcmZyeGVveTFmenM0OWxwb2pheGZ3MW8ifQ.ka2dxppOoMDqiLiqzhh96Q';    
    var marker = 0;
    var client = new MapboxClient(mapboxgl.accessToken);
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v10',
    });

    $('#user_address').on('keyup', () => {
        getCoordinates();
    })

    function getCoordinates(){
        if (marker) { marker.remove() }
        var getAddress = document.getElementById('user_address').value;
        client.geocodeForward(getAddress, function(err, data, res){
            var coordinates = data.features[0].center;
            $('#user_long')[0].value = coordinates[0];
            $('#user_lat')[0].value = coordinates[1];
            
            map.flyTo({
                center: coordinates,
                zoom: 18,
            });

            var marker = new mapboxgl.Marker().setLngLat(coordinates).addTo(map);
        });
    }
})
</script>